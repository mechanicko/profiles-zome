{"version":3,"file":"hc-profiles.umd.js","sources":["../src/bindings.ts","../src/graphql/schema.ts","../src/graphql/resolvers.ts","../src/graphql/queries.ts","../src/elements/hcpf-set-username.ts","../src/profiles.module.ts"],"sourcesContent":["export const ProfilesBindings = {\n  ProfilesProvider: \"holochain-profiles-provider\"\n};\n","import gql from 'graphql-tag';\n\nexport const profilesTypeDefs = gql`\n  type Agent {\n    id: ID!\n    username: String\n  }\n\n  extend type Query {\n    allAgents: [Agent!]!\n    me: Agent!\n  }\n\n  extend type Mutation {\n    setUsername(username: String!): Agent!\n  }\n`;\n","import { HolochainProvider } from '@uprtcl/holochain-provider';\n\nimport { ProfilesBindings } from '../bindings';\n\nexport const resolvers = {\n  Query: {\n    async allAgents(_, __, { container }) {\n      const profilesProvider: HolochainProvider = container.get(\n        ProfilesBindings.ProfilesProvider\n      );\n\n      const allAgents = await profilesProvider.call('get_all_agents', {});\n      return allAgents.map((agent) => ({\n        id: agent.agent_id,\n        username: agent.username,\n      }));\n    },\n    async me(_, __, { container }) {\n      const profilesProvider: HolochainProvider = container.get(\n        ProfilesBindings.ProfilesProvider\n      );\n\n      const address = await profilesProvider.call('get_my_address', {});\n      return { id: address };\n    },\n  },\n  Agent: {\n    id(parent) {\n      return parent.id;\n    },\n    username(parent, _, { container }) {\n      const profilesProvider: HolochainProvider = container.get(\n        ProfilesBindings.ProfilesProvider\n      );\n\n      return profilesProvider.call('get_username', {\n        agent_address: parent.id,\n      });\n    },\n  },\n  Mutation: {\n    async setUsername(_, { username }, { container }) {\n      const profilesProvider: HolochainProvider = container.get(\n        ProfilesBindings.ProfilesProvider\n      );\n\n      const agentId = await profilesProvider.call('set_username', { username });\n      return {\n        id: agentId,\n        username,\n      };\n    },\n  },\n};\n","import gql from 'graphql-tag';\n\nexport const SET_USERNAME = gql`\n  mutation SetUsername($username: String!) {\n    setUsername(username: $username) {\n      id\n      username\n    }\n  }\n`;\n\nexport const GET_ALL_AGENTS = gql`\n  query GetAllAgents {\n    allAgents {\n      id\n      username\n    }\n  }\n`","import { moduleConnect } from '@uprtcl/micro-orchestrator';\nimport { LitElement, css, html, query, property } from 'lit-element';\nimport { ApolloClient } from 'apollo-boost';\nimport { ApolloClientModule } from '@uprtcl/graphql';\n\nimport { TextField } from '@material/mwc-textfield';\nimport '@material/mwc-button';\nimport { SET_USERNAME } from '../graphql/queries';\n\nexport class SetUsername extends moduleConnect(LitElement) {\n  @query('#username-field')\n  usernameField!: TextField;\n\n  @property({ type: Number })\n  usernameMinLength: number = 3;\n\n  client!: ApolloClient<any>;\n\n  firstUpdated() {\n    this.client = this.request(ApolloClientModule.bindings.Client);\n\n    this.usernameField.validityTransform = (newValue) => {\n      this.requestUpdate();\n      if (newValue.length < this.usernameMinLength) {\n        this.usernameField.setCustomValidity(\n          `Username is too shot, min. ${this.usernameMinLength} characters`\n        );\n        return {\n          valid: false,\n        };\n      }\n\n      return {\n        valid: true,\n      };\n    };\n  }\n\n  static get styles() {\n    return css`\n      .row {\n        display: flex;\n        flex-direction: row;\n      }\n      .column {\n        display: flex;\n        flex-direction: column;\n      }\n    `;\n  }\n\n  async setUsername() {\n    const username = this.usernameField.value;\n    await this.client.mutate({\n      mutation: SET_USERNAME,\n      variables: {\n        username,\n      },\n    });\n\n    this.dispatchEvent(\n      new CustomEvent('username-set', {\n        detail: { username },\n        bubbles: true,\n        composed: true,\n      })\n    );\n  }\n\n  render() {\n    return html`\n      <div class=\"column\">\n        <mwc-textfield\n          id=\"username-field\"\n          @input=${() => this.usernameField.reportValidity()}\n        ></mwc-textfield>\n        <mwc-button\n          .disabled=${!this.usernameField || !this.usernameField.validity.valid}\n          label=\"SET USERNAME\"\n          @click=${() => this.setUsername()}\n        ></mwc-button>\n      </div>\n    `;\n  }\n}\n","import { interfaces } from 'inversify';\nimport { GraphQlSchemaModule } from '@uprtcl/graphql';\nimport { MicroModule, i18nextModule } from '@uprtcl/micro-orchestrator';\nimport {\n  HolochainConnectionModule,\n  createHolochainProvider,\n} from '@uprtcl/holochain-provider';\n\nimport en from './i18n/en.json';\nimport { ProfilesBindings } from './bindings';\nimport { profilesTypeDefs } from './graphql/schema';\nimport { resolvers } from './graphql/resolvers';\nimport { SetUsername } from './elements/hcpf-set-username';\n\nexport class ProfilesModule extends MicroModule {\n  static id = 'holochain-profile-module';\n\n  dependencies = [HolochainConnectionModule.id];\n\n  static bindings = ProfilesBindings;\n\n  constructor(protected instance: string) {\n    super();\n  }\n\n  async onLoad(container: interfaces.Container) {\n    const profilesProvider = createHolochainProvider(this.instance, 'profiles');\n\n    container.bind(ProfilesBindings.ProfilesProvider).to(profilesProvider);\n\n    customElements.define('hcpf-set-username', SetUsername);\n  }\n\n  get submodules() {\n    return [\n      new GraphQlSchemaModule(profilesTypeDefs, resolvers),\n      new i18nextModule('profiles', { en: en }),\n    ];\n  }\n}\n"],"names":["moduleConnect","LitElement","ApolloClientModule","css","html","query","TextField","property","MicroModule","HolochainConnectionModule","createHolochainProvider","GraphQlSchemaModule","i18nextModule"],"mappings":"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"}